{% extends "./base.html" %}

<!-- Body -->
{% block body %}
<div>
  <form id="js_publishForm" action="#">
    <p class="text-center">æ˜å¤©æ˜¯: {{ tomorrow }}</p>
    <input class="input-block" name="code" style="width: 100%;" type="text" placeholder="è¯·è¾“å…¥æˆæƒç " />
    <br />
    <input class="input-block" name="name" style="width: 100%;" type="text" placeholder="è¯·è¾“å…¥èœå" />
    <br />
    <div class="card">
      <div class="card-header text-success">è¾…æ–™è¡¨:</div>
      <div class="card-body">
        <fieldset class="form-group">
          <label for="js_onion" class="paper-switch-label">è‘±:</label>
          <label class="paper-switch pull-right">
            <input id="js_onion" name="hasOnion" type="checkbox" />
            <span class="paper-switch-slider"></span>
          </label>
        </fieldset>

        <fieldset class="form-group">
          <label for="js_ginger" class="paper-switch-label">å§œ:</label>
          <label class="paper-switch pull-right">
            <input id="js_ginger" name="hasGinger" type="checkbox" />
            <span class="paper-switch-slider"></span>
          </label>
        </fieldset>

        <fieldset class="form-group">
          <label for="js_garlic" class="paper-switch-label">è’œ:</label>
          <label class="paper-switch pull-right">
            <input id="js_garlic" name="hasGarlic" type="checkbox" />
            <span class="paper-switch-slider"></span>
          </label>
        </fieldset>

        <fieldset class="form-group">
          <label for="js_pepper" class="paper-switch-label">èŠ±æ¤’:</label>
          <label class="paper-switch pull-right">
            <input id="js_pepper" name="hasPepper" type="checkbox" />
            <span class="paper-switch-slider"></span>
          </label>
        </fieldset>

        <fieldset class="form-group">
          <legend>ç›:</legend>
          <label class="paper-radio">
            <input type="radio" name="saltLevel" value="ä¸€ä¸¢ä¸¢" />
            <span>ä¸€ä¸¢ä¸¢</span>
          </label>
          <label class="paper-radio">
            <input type="radio" name="saltLevel" value="æå°‘" />
            <span>æå°‘</span>
          </label>
          <label class="paper-radio">
            <input type="radio" name="saltLevel" value="é€‚ä¸­" />
            <span>é€‚ä¸­</span>
          </label>
          <label class="paper-radio">
            <input type="radio" name="saltLevel" value="å¤§é‡" />
            <span>å¤§é‡</span>
          </label>
        </fieldset>

        <div class="form-group">
          <label>æç¤º</label>
          <textarea class="no-resize" name="tips" style="width: 100%;" placeholder="è¯·è¾“å…¥çˆ±å¿ƒæç¤º"></textarea>
        </div>
      </div>
    </div>
    <br />

    <button id="js_submitBtn" type="submit" class="btn-block">æäº¤</button>
  </form>

  <div id="js_modal" class="modal">
    <label class="modal-bg"></label>
    <div class="modal-body">
      <label class="btn-close">X</label>
      <h4 class="modal-title"></h4>
      <p class="modal-text"></p>
      <label class="modal-ok">OK!</label>
    </div>
  </div>
</div>
<!---->
{% endblock %}

<!-- Foot -->
{% block foot %}
<script>
  $(document).ready(function () {
    var $modal = $("#js_modal");

    $("#js_publishForm").on("submit", function (evt) {
      evt.preventDefault();
      var fd = $("#js_publishForm").serializeJSON();
      if (!fd.code) {
        showModal("ğŸ§ğŸ§ğŸ§", "è¯·è¾“å…¥æˆæƒç !");
        return;
      }
      if (!fd.name) {
        showModal("ğŸ§ğŸ§ğŸ§", "è¯·è¾“å…¥èœå!");
        return;
      }
      if (!fd.saltLevel) {
        showModal("ğŸ§ğŸ§ğŸ§", "è¯·é€‰æ‹©ç›é‡!");
        return;
      }
      $.ajax({
        type: "POST",
        url: "/api/publish",
        data: fd,
        success: function (res) {
          if (!res.success) {
            showModal("ğŸ§ğŸ§ğŸ§", res.message);
            return;
          }
          showModal("ğŸ¤“ğŸ¤“ğŸ¤“", "æäº¤æˆåŠŸäº†~");
          $("#js_submitBtn").addClass("disabled").attr("disabled", "disabled");
        },
      });
    });

    $modal.find(".btn-close, .modal-ok").on("click", function () {
      closeModal();
    });

    function showModal(title, text) {
      $modal.find(".modal-title").text(title);
      $modal.find(".modal-text").text(text);
      $modal.addClass("modal-visible");
    }

    function closeModal() {
      $modal.find(".modal-title").text("");
      $modal.find(".modal-text").text("");
      $modal.removeClass("modal-visible");
    }
  });
</script>
{% endblock %}
